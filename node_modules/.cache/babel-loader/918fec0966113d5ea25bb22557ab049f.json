{"ast":null,"code":"import e from \"qs\";\nimport { createElement as r, Children as t, Component as n } from \"react\";\nimport o from \"prop-types\";\n\nvar i = function (e, r, t) {\n  return Object.defineProperty(e, r, {\n    enumerable: !1,\n    configurable: !1,\n    writable: !1,\n    value: t\n  }), e;\n};\n\nfunction s(r, t) {\n  if (null == t) return r;\n  var n = e.stringify(t);\n  return n ? r + (r.indexOf(\"?\") < 0 ? \"?\" : \"&\") + n : r;\n}\n\nvar c = function (n) {\n  function o(e) {\n    n.call(this, e), this.state = {\n      processing: !0,\n      state: null,\n      error: null\n    }, this.getAuthorizationCode = this.getAuthorizationCode.bind(this), this.handleError = this.handleError.bind(this), this.parseQuerystring = this.parseQuerystring.bind(this);\n  }\n\n  return n && (o.__proto__ = n), (o.prototype = Object.create(n && n.prototype)).constructor = o, o.prototype.componentDidMount = function () {\n    this.getAuthorizationCode();\n  }, o.prototype.getAuthorizationCode = function () {\n    var e = this;\n\n    try {\n      var r = this.props,\n          t = r.tokenUrl,\n          n = r.tokenFetchArgs,\n          o = r.clientId,\n          c = r.clientSecret,\n          u = r.redirectUri,\n          l = r.args,\n          a = r.tokenFn,\n          p = r.onAuthSuccess,\n          h = this.parseQuerystring(),\n          d = h.error,\n          f = h.error_description,\n          g = h.code,\n          y = JSON.parse(h.state || null);\n      if (y && this.setState(function () {\n        return {\n          state: y\n        };\n      }), null != d) throw new Error(f);\n      var b = s(\"\" + t, Object.assign({}, {\n        code: g,\n        grant_type: \"authorization_code\",\n        client_id: o,\n        client_secret: c,\n        redirect_uri: u\n      }, l)),\n          m = new Headers({\n        \"Content-Type\": \"application/json\"\n      }),\n          v = Object.assign({\n        method: \"POST\",\n        headers: m\n      }, n);\n      (\"function\" == typeof a ? a(b, v) : function (e, r) {\n        var t = fetch(e, r);\n        return t.then(function (e) {\n          if (!e.ok) throw e;\n          return e.json();\n        }).catch(function (e) {\n          return e.json().then(function (r) {\n            var n = new Error(e.statusText);\n            throw i(n, \"response\", e), i(n.response, \"data\", r), i(n, \"request\", t), n;\n          });\n        });\n      }(b, v)).then(function (r) {\n        \"function\" == typeof p && p(r.access_token, {\n          response: r,\n          state: y\n        }), e.setState(function () {\n          return {\n            processing: !1\n          };\n        });\n      }).catch(function (r) {\n        e.handleError(r), e.setState(function () {\n          return {\n            processing: !1\n          };\n        });\n      });\n    } catch (e) {\n      this.handleError(e), this.setState(function () {\n        return {\n          processing: !1\n        };\n      });\n    }\n  }, o.prototype.handleError = function (e) {\n    var r = this.props.onAuthError;\n    this.setState(function () {\n      return {\n        error: e\n      };\n    }), \"function\" == typeof r && r(e);\n  }, o.prototype.parseQuerystring = function () {\n    var r,\n        t = this.props,\n        n = t.location,\n        o = t.querystring;\n    return r = null != n ? n.search : null != o ? o : window.location.search, e.parse(r, {\n      ignoreQueryPrefix: !0\n    });\n  }, o.prototype.render = function () {\n    var e = this.props,\n        n = e.component,\n        o = e.render,\n        i = e.children,\n        s = this.state,\n        c = s.processing,\n        u = s.state,\n        l = s.error;\n    return null != n ? r(n, {\n      processing: c,\n      state: u,\n      error: l\n    }) : null != o ? o({\n      processing: c,\n      state: u,\n      error: l\n    }) : null != i ? (t.only(i), i({\n      processing: c,\n      state: u,\n      error: l\n    })) : null;\n  }, o;\n}(n);\n\nc.propTypes = {\n  tokenUrl: o.string.isRequired,\n  clientId: o.string.isRequired,\n  clientSecret: o.string.isRequired,\n  redirectUri: o.string.isRequired,\n  args: o.objectOf(o.oneOfType([o.string, o.number, o.bool, o.object])),\n  location: o.shape({\n    search: o.string.isRequired\n  }),\n  querystring: o.string,\n  tokenFn: o.func,\n  onAuthSuccess: o.func,\n  onAuthError: o.func,\n  render: o.func,\n  tokenFetchArgs: o.shape({\n    method: o.string\n  }),\n  component: o.element,\n  children: o.func\n}, c.defaultProps = {\n  args: {},\n  location: null,\n  querystring: null,\n  tokenFn: null,\n  onAuthSuccess: null,\n  onAuthError: null,\n  render: null,\n  tokenFetchArgs: {},\n  component: null,\n  children: null\n};\n\nvar u = function (e) {\n  function n() {\n    e.apply(this, arguments);\n  }\n\n  return e && (n.__proto__ = e), (n.prototype = Object.create(e && e.prototype)).constructor = n, n.prototype.render = function () {\n    var e = this.props,\n        n = e.state,\n        o = e.args,\n        i = e.render,\n        c = e.component,\n        u = e.children,\n        l = s(\"\" + e.authorizeUrl, Object.assign({}, {\n      client_id: e.clientId,\n      redirect_uri: e.redirectUri,\n      response_type: \"code\",\n      state: n ? JSON.stringify(n) : void 0\n    }, o || {}));\n    return null != c ? r(c, {\n      url: l\n    }) : null != i ? i({\n      url: l\n    }) : null != u ? (t.only(u), u({\n      url: l\n    })) : null;\n  }, n;\n}(n);\n\nfunction l(e) {\n  void 0 === e && (e = {});\n  var r = e.authorizeUrl,\n      t = e.tokenUrl,\n      n = e.clientId,\n      o = e.clientSecret,\n      i = e.redirectUri,\n      s = e.appName;\n  return {\n    Sender: function (e) {\n      return h(u, Object.assign({}, {\n        authorizeUrl: r,\n        clientId: n,\n        redirectUri: i\n      }, e));\n    },\n    Receiver: function (e) {\n      return h(c, Object.assign({}, {\n        tokenUrl: t,\n        clientId: n,\n        clientSecret: o,\n        redirectUri: i,\n        appName: s\n      }, e));\n    }\n  };\n}\n\nu.propTypes = {\n  authorizeUrl: o.string.isRequired,\n  clientId: o.string.isRequired,\n  redirectUri: o.string.isRequired,\n  state: o.objectOf(o.oneOfType([o.string, o.number, o.bool, o.object])),\n  args: o.objectOf(o.oneOfType([o.string, o.number, o.bool, o.object])),\n  render: o.func,\n  component: o.element,\n  children: o.func\n}, u.defaultProps = {\n  state: null,\n  args: null,\n  render: null,\n  component: null,\n  children: null\n};\nexport { l as createOauthFlow, u as OauthSender, c as OauthReceiver };","map":null,"metadata":{},"sourceType":"module"}